<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Lyapunov spectrum of Lorenz system · TaylorIntegration.jl</title><meta name="title" content="Lyapunov spectrum of Lorenz system · TaylorIntegration.jl"/><meta property="og:title" content="Lyapunov spectrum of Lorenz system · TaylorIntegration.jl"/><meta property="twitter:title" content="Lyapunov spectrum of Lorenz system · TaylorIntegration.jl"/><meta name="description" content="Documentation for TaylorIntegration.jl."/><meta property="og:description" content="Documentation for TaylorIntegration.jl."/><meta property="twitter:description" content="Documentation for TaylorIntegration.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">TaylorIntegration.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../taylor_method/">Taylor&#39;s method</a></li><li><a class="tocitem" href="../lyapunov_spectrum/">Lyapunov spectrum</a></li><li><a class="tocitem" href="../jet_transport/">Jet transport</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../simple_example/">Infinity in finite time</a></li><li><a class="tocitem" href="../kepler/">The Kepler problem</a></li><li class="is-active"><a class="tocitem" href>Lyapunov spectrum of Lorenz system</a></li><li><a class="tocitem" href="../pendulum/">Jet transport: the simple pendulum</a></li><li><a class="tocitem" href="../root_finding/">Poincaré maps</a></li><li><a class="tocitem" href="../common/">Interoperability with <code>DifferentialEquations.jl</code></a></li></ul></li><li><a class="tocitem" href="../taylorize/">Optimizing: <code>@taylorize</code></a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Lyapunov spectrum of Lorenz system</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Lyapunov spectrum of Lorenz system</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PerezHz/TaylorIntegration.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/PerezHz/TaylorIntegration.jl/blob/main/docs/src/lorenz_lyapunov.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="lyap_lorenz"><a class="docs-heading-anchor" href="#lyap_lorenz">Lyapunov spectrum of Lorenz system</a><a id="lyap_lorenz-1"></a><a class="docs-heading-anchor-permalink" href="#lyap_lorenz" title="Permalink"></a></h1><p>Here, we present the calculation of the Lyapunov spectrum of the <a href="https://en.wikipedia.org/wiki/Lorenz_system">Lorenz system</a>, using <code>TaylorIntegration.jl</code>. The computation involves evaluating the 1st order variational equations <span>$\dot \xi = J \cdot \xi$</span> for this system, where <span>$J = \operatorname{D}f$</span> is the Jacobian. By default, the numerical value of the Jacobian is computed using automatic differentiation techniques implemented in <a href="https://github.com/JuliaDiff/TaylorSeries.jl"><code>TaylorSeries.jl</code></a>, which saves us from writing down explicitly the Jacobian. Conversely, this can be used to check a function implementing the Jacobian. As an alternative, specially important if performance is critical, the user may provide a Jacobian function.</p><p>The Lorenz system is the ODE defined as:</p><p class="math-container">\[\begin{aligned}
    \dot{x}_1 &amp; =  \sigma(x_2-x_1), \\
    \dot{x}_2 &amp; =  x_1(\rho-x_3)-x_2, \\
    \dot{x}_3 &amp; =  x_1x_2-\beta x_3,
\end{aligned}\]</p><p>where <span>$\sigma$</span>, <span>$\rho$</span> and <span>$\beta$</span> are constant parameters.</p><p>First, we write a Julia function which evaluates (in-place) the Lorenz system:</p><pre><code class="language-julia hljs">#Lorenz system ODE:
function lorenz!(dq, q, params, t)
    σ, ρ, β = params
    x, y, z = q
    dq[1] = σ*(y-x)
    dq[2] = x*(ρ-z)-y
    dq[3] = x*y-β*z
    nothing
end</code></pre><p>Below, we use the the parameters <span>$\sigma = 16.0$</span>, <span>$\beta = 4$</span> and <span>$\rho = 45.92$</span>.</p><pre><code class="language-julia hljs">#Lorenz system parameters
#we use the `const` prefix in order to help the compiler speed things up
const params = [16.0, 45.92, 4.0]</code></pre><p>We define the initial conditions, the initial and final integration times for the integration:</p><pre><code class="language-julia hljs">const x0 = [19.0, 20.0, 50.0] #the initial condition
const t0 = 0.0     #the initial time
const tmax = 100.0 #final time of integration</code></pre><p>Since the diagonal of the Jacobian is constant, the sum of the Lyapunov spectrum has to be equal to that value. We calculate this trace using <code>TaylorSeries.jl</code>, and after the numerical integration, we will come back to check if this value is conserved (or approximately conserved) as a function of time.</p><pre><code class="language-julia hljs"># Note that TaylorSeries.jl is @reexport-ed by TaylorIntegration.jl
# Calculate trace of Lorenz system Jacobian via TaylorSeries.jacobian:
import LinearAlgebra: tr
using TaylorIntegration
xi = set_variables(&quot;δ&quot;, order=1, numvars=length(x0))
x0TN = x0 .+ xi
dx0TN = similar(x0TN)
lorenz!(dx0TN, x0TN, params, t0)
jjac = TaylorSeries.jacobian(dx0TN)
lorenztr = tr(jjac) #trace of Lorenz system Jacobian matrix</code></pre><p>As explained above, the user may provide a function which computes the Jacobian of the ODE in-place:</p><pre><code class="language-julia hljs">#Lorenz system Jacobian (in-place):
function lorenz_jac!(jac, x, params, t)
    σ, ρ, β = params
    jac[1,1] = -σ + zero(x[1])
    jac[1,2] = σ + zero(x[1])
    jac[1,3] = zero(x[1])
    jac[2,1] = ρ - x[3]
    jac[2,2] = -1.0 + zero(x[1])
    jac[2,3] = -x[1]
    jac[3,1] = x[2]
    jac[3,2] = x[1]
    jac[3,3] = -β + zero(x[1])
    nothing
end</code></pre><div class="admonition is-info" id="Note-5c555eeeafadacfa"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-5c555eeeafadacfa" title="Permalink"></a></header><div class="admonition-body"><p>We use of <code>zero(x[1])</code> in the function <code>lorenz_jac!</code> when the RHS consists of a numeric value; this is needed to allow the proper promotion of the variables to carry out Taylor&#39;s method.</p></div></div><p>We can actually check the consistency of <code>lorenz_jac!</code> with the computation of the jacobian using automatic differentiation techniques. Below we use the initial conditions <code>x0</code>, but it is easy to generalize this.</p><pre><code class="language-julia hljs">lorenz_jac!(jjac, x0, params, t0)  # update the matrix `jjac` using Jacobian provided by the user
TaylorSeries.jacobian(dx0TN) == jjac    # `dx0TN` is obtained via automatic differentiation</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>Now, we are ready to perform the integration using <code>lyap_taylorinteg</code> function, which integrates the 1st variational equations and uses Oseledets&#39; theorem. The expansion order will be <span>$28$</span> and the local absolute tolerance will be <span>$10^{-20}$</span>. <code>lyap_taylorinteg</code> will return three arrays: one with the evaluation times, one with the values of the dependent variables (at the time of evaluation), and another one with the values of the Lyapunov spectrum.</p><p>We first carry out the integration computing internally the Jacobian</p><pre><code class="language-julia hljs">sol = lyap_taylorinteg(lorenz!, x0, t0, tmax, 28, 1e-20, params; maxsteps=2000000);
tv, xv, λv = sol.t, sol.x, sol.λ</code></pre><p>Now, the integration is obtained exploiting <code>lorenz_jac!</code>:</p><pre><code class="language-julia hljs">sol_ = lyap_taylorinteg(lorenz!, x0, t0, tmax, 28, 1e-20, params, lorenz_jac!; maxsteps=2000000);
tv_, xv_, λv_ = sol_.t, sol_.x, sol_.λ</code></pre><p>In terms of performance the second method is about ~50% faster than the first.</p><p>We check the consistency of the orbits computed by the two methods:</p><pre><code class="language-julia hljs">tv == tv_, xv == xv_, λv == λv_</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(true, true, true)</code></pre><p>As mentioned above, a more subtle check is related to the fact that the trace of the Jacobian is constant in time, which must coincide with the sum of all Lyapunov exponents. Using its initial value <code>lorenztr</code>, we compare it with the final Lyapunov exponents of the computation, and obtain</p><pre><code class="language-julia hljs">sum(λv[end,:]) ≈ lorenztr, sum(λv_[end,:]) ≈ lorenztr, sum(λv[end,:]) ≈ sum(λv_[end,:])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(true, true, true)</code></pre><p>Above we checked the approximate equality; we now show that the relative error is quite small and comparable with the local machine epsilon value around <code>lorenztr</code>:</p><pre><code class="language-julia hljs">abs(sum(λv[end,:])/lorenztr - 1), abs(sum(λv_[end,:])/lorenztr - 1), eps(lorenztr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(1.1102230246251565e-15, 1.1102230246251565e-15, 3.552713678800501e-15)</code></pre><p>Therefore, the numerical error is dominated by roundoff errors in the floating point arithmetic of the integration. We will now proceed to plot our results. First, we plot Lorenz attractor in phase space</p><pre><code class="language-julia hljs">using Plots
plot(xv[:,1], xv[:,2], xv[:,3], leg=false)</code></pre><img src="a753650a.svg" alt="Example block output"/><p>We display now the Lyapunov exponents as a function of time:</p><pre><code class="language-julia hljs">using Plots
plot(tv, λv[:,1], label=&quot;L_1&quot;, legend=:right)
plot!(tv, λv[:,2], label=&quot;L_2&quot;)
plot!(tv, λv[:,3], label=&quot;L_3&quot;)
xlabel!(&quot;time&quot;)
ylabel!(&quot;L_i, i=1,2,3&quot;)
title!(&quot;Lyapunov exponents vs time&quot;)</code></pre><img src="bb34c6d2.svg" alt="Example block output"/><p>This plot shows that the calculation of the Lyapunov exponents has converged.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../kepler/">« The Kepler problem</a><a class="docs-footer-nextpage" href="../pendulum/">Jet transport: the simple pendulum »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 25 August 2025 17:02">Monday 25 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
